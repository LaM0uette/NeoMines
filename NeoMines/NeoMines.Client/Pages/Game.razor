@page "/Game/{GameModeIndex:int}"
@using NeoMines.Model.Game
@inherits GameBase
@rendermode InteractiveWebAssembly

<title>Game - @GameMode</title>

<div class="game-body">

    <div class="info-game">
        <div class="info-game__bomb-icon"></div>
        <p class="info-game__bomb-count">NA</p>
        <p>IsGameOver: @IsGameOver </p>
        <p>IsWin: @IsWin </p>
    </div>

    <div class="mine-grid">
        
        @for (var row = 0; row < Rows; row++)
        {
            for (var col = 0; col < Columns; col++)
            {
                var currentRow = row;
                var currentColumn = col;
                
                var cell = Grid[row, col];
                
                var undiscoveredClass = !cell.IsDiscovered ? "cell-undiscovered" : "";
                var cellClass = "";
                var cellText = "";
                
                if (cell.HasFlag)
                {
                    cellClass = "cell-flag";
                    cellText = "🚩";
                }
                else if (cell.IsDiscovered)
                {
                    if (cell is BombCell)
                    {
                        cellClass = "cell-bomb";
                        cellText = "💣";
                    }
                    else if (cell is NumberCell numberCell)
                    {
                        cellClass = $"cell-number-{numberCell.Number}";
                        cellText = numberCell.Number.ToString();
                    }
                }
                
                <button class="mine-cell @undiscoveredClass @cellClass"
                        @onclick="() => OnLeftClick(currentRow, currentColumn)"
                        @oncontextmenu="() => OnRightClick(currentRow, currentColumn)"
                        @oncontextmenu:preventDefault="true"
                        disabled="@(IsGameOver || IsWin)">
                    @cellText
                </button>
            }
        }
        
    </div>
    
</div>